<%-include("../user/layouts/header.ejs") %>
<style>
     /* CSS styling for the coupon management section */
    
    
     .coupon {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    max-width:auto;
    margin: 20px auto;
    position: relative;
    overflow: hidden;
}
.selected {
 background-color: rgb(128, 128, 206);
 color: white; 
}


.coupon-logo {
    max-width: 100px;
    margin-bottom: 15px;
}
.coupon-amount {
    font-size: 20px;
    color: #f00; /* Red color for emphasis */
}
    .apply-button {
        background-color: #4CAF50;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .apply-button:hover {
        background-color: #45a049;
    }

    .remove-button {
        background-color: #f44336;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .remove-button:hover {
        background-color: #da190b;
    }
 /* Styling for cart summary table */
    /* Cart summary table styling */
    .cart-summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    .cart-summary-table th,
    .cart-summary-table td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }

    .cart-summary-table th {
        background-color: #f2f2f2;
    }

    .cart-summary-table tbody tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    .address-item {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        margin-bottom: 15px;
        padding: 15px;
        transition: all 0.3s ease;
    }

    .address-item:hover {
        background-color: #e9ecef;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-3px);
    }

    /* Styling for radio input */
    .address-item input[type="radio"] {
        margin-right: 10px;
    }

    /* Styling for card title */
    .card-title {
        font-size: 18px;
        margin-bottom: 10px;
    }

    /* Styling for card text */
    .card-text {
        margin-bottom: 5px;
    }
    .shipping
    {
width:250px
    }
</style>
<br>
<br>
<br>
<br>
<div class="container">
    <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
        <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
            Home
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
        </a>
        
        <a href="/shop" class="stext-109 cl8 hov-cl1 trans-04">
            products
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
        </a>
        <a href="/cart" class="stext-109 cl8 hov-cl1 trans-04">
            cart
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
        </a>
        <a href="/checkout" class="stext-109 cl8 hov-cl1 trans-04">
            checkout
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
        </a>
        <span class="stext-109 cl4">
            
        </span>
    </div>
</div>
<br><br>
<br>

<div id="checkout-container">
<form id="checkout-form">
    <div class="main-wrapper">
        <div class="checkout_area pt--120 pt_md--80 pt_sm--80 pb--60 bg-color"
            data-bg-color="#ffffff">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6">
                        <h3>your Address</h3>
                        <div class="row">

                            <% if (addressData && addressData.address &&
                            addressData.address.length > 0) { %>
                            <% addressData.address.forEach((address, index) => {
                            %>
                            <div class="col-lg-6 ">
                                <div class="card address-item">
                                    <input type="radio" class="pl-4 ml-3 mr-1"
                                        name="address"
                                        value='<%= JSON.stringify(address) %>'
                                        <%=index === 0 ? 'checked' : '' %> />
                                    <div class="card-body">
                                        <h5 class="card-title">Address <%=
                                            index+1 %></h5>
                                        <p
                                            class="card-text"><strong>Name:</strong>
                                            <%= address.fullName %></p>
                                        <p
                                            class="card-text"><strong>Email:</strong>
                                            <%= address.email %></p>
                                        <p
                                            class="card-text"><strong>Mobile:</strong>
                                            <%= address.mobile %></p>
                                        <p
                                            class="card-text"><strong>State:</strong>
                                            <%= address.state %></p>
                                        <p
                                            class="card-text"><strong>City:</strong>
                                            <%= address.city %></p>
                                        <p
                                            class="card-text"><strong>Pincode:</strong>
                                            <%= address.pin %></p>
                                        <p class="card-text"><strong>House
                                                Name:</strong> <%=
                                            address.houseName %></p>
                                    </div>
                                </div>

                            </div>
                            <% }) %>
                            <% } else { %>
                            <div class="col-lg-12 mb-4">
                                <button id="addAddressButton">Add
                                    Address</button>
                            </div>
                            <% } %>
                        </div>

                        <!-- Coupon Management Section -->
                     
                        <div class="discount-coupon">
                            <h4>Discount Coupon Code</h4>
                                <div class="row">
                                    <div class="col-md-6 col-12 mb--25">
                                        <input type="text" id="couponCodeInput" placeholder="Coupon Code" style="font-weight: bold; color: red;" disabled>
                                    </div>
                                    <div class="col-md-6 col-12 mb--25 button-container">
                                        <input type="button" value="check coupons" onclick="showDiscountModal()" style="color: white; background-color: black; width: auto; display: inline-block; margin-right: 10px;">
                                        <input type="button" value="remove coupon" onclick="removeCoupon()" style="color: white; background-color: black; width: auto; display: inline-block;">
                                    </div>
                                    
                                 
                               
                                </div>
                        </div>
             </div>
                    
                    <div class="col-lg-6" style="padding-bottom: 20px;">
                        <div class="mb--60">
                            <h4 class="checkout-title">Cart Total</h4>
                            <div class="checkout-cart-total">
                                <div class="card">
                                    <table class="cart-summary-table">
                                        <thead>
                                            <tr>
                                                <th scope="col">Product</th>
                                                <th scope="col">Total</th>
                                        
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% cart.products.forEach((product,index) => { %>
                                                <tr>
                                                    <td><%= product.productId.name  %> x <%=  eachQuantity[index] %></td>
                                                    <td>₹<%= eachTotal[index].toFixed(2) %></td>
                                                    
                                                </tr>
                                            <% }); %>
                                            <tr >
                                                <td >Sub Total</td>
                                                <td class="shipping">₹<%= subTotal.toFixed(2) %></td> <!-- Format subTotal to two decimal places -->
                                            </tr>
                                            <tr>
                                                <td>Shipping Fee</td>
                                                <td>₹<%= shippingAmount.toFixed(2) %></td> <!-- Format shippingAmount to two decimal places -->
                                            </tr>
                                            <tr>
                                                <td>Grand Total</td>
                                                <td>₹<%= total.toFixed(2) %></td> <!-- Format total to two decimal places -->
                                            </tr>
                                        </tbody>
                                        
                                    </table>
                                    <div style="padding: 15px;">
                                        <h4 class="checkout-title ">PAYMENT
                                            METHOD</h4>
                                        <div class="single-method">
                                            <!-- Payment method options go here -->
                                            <div>
                                                
                                          
                                           
                                               
                                                    <input type="radio" id="COD"
                                                name="payment" value="COD"
                                                checked>
                                                <label for="COD" style="font-weight: bold;">Cash on
                                                    Delivery</label>
                                                   
                                            </div>
                                            <div>
                                                <input type="radio" id="razorpay" name="payment" value="razorpay">
                                                <label for="razorpay" style="font-weight: bold;">razorpay</label>
                                            </div>
                                            <div>
                                                <input type="radio" id="wallet" name="payment" value="wallet">
                                                <label for="wallet" style="font-weight: bold;">wallet</label>
                                            </div>
                                         
                                        </div>
                                        <div style="text-align: center;">
                                            <button type="button" id="place-order"
                                                class="place-order">Place
                                                Order</button>
                                        </div>
                                    </div>
                                   
                                   
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    


   
   



    <!--// Quick View Modal -->
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

   
<script>
    const paymentMethod = $("input[name='payment']:checked").val();
    const formData = {
        address: address,
        payment: paymentMethod,
    };
    

                    $.ajax({
                        url: "/place-order",
                        method: "POST",
                        contentType: 'application/json',
                        data: JSON.stringify({ formData }),
                        success: (response) => {
                            console.log('rssdgfsdfs',response);
                            if(response.stock){
                                swal.fire({
                                title: "bad request!",
                                text:"product is out of stock ,plese remove out of stock product for your place holder",
                                icon: "warning"
                                });               
                            } else if (response.codsuccess == true) {
                                swal.fire({
                                icon: "success",
                                title:"cash on delivery",
                                text:"order success",
                                timer: 3000
                                }).then(()=> {        
                                    window.location.href = `/order-success`;
                                });
                            }else if(response.wallet){
                                swal.fire({
                                icon: "success",
                                title:"wallet",
                                text:"order success",
                                timer: 3000
                                }).then(()=> {        
                                    window.location.href = `/order-success`;
                                });   
                            }else if(response.walletAmount){
                                swal.fire({
                                icon: "error",
                                text:"wallet amount not enough",
                                })  
                        }else if (response.paypal) {
                        window.location.href = response.paypal;
                    }
                        },
                    });
           
                
            
</script>

<%-include("../user/layouts/footer.ejs") %>